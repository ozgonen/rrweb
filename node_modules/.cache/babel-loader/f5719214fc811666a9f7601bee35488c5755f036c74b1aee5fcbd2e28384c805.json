{"ast":null,"code":"import { getCssRuleString } from '../../../rrweb-snapshot/es/rrweb-snapshot.js';\nimport { StyleSheetMirror } from '../utils.js';\nclass StylesheetManager {\n  constructor(options) {\n    this.trackedLinkElements = new WeakSet();\n    this.styleMirror = new StyleSheetMirror();\n    this.mutationCb = options.mutationCb;\n    this.adoptedStyleSheetCb = options.adoptedStyleSheetCb;\n  }\n  attachLinkElement(linkEl, childSn) {\n    if ('_cssText' in childSn.attributes) this.mutationCb({\n      adds: [],\n      removes: [],\n      texts: [],\n      attributes: [{\n        id: childSn.id,\n        attributes: childSn.attributes\n      }]\n    });\n    this.trackLinkElement(linkEl);\n  }\n  trackLinkElement(linkEl) {\n    if (this.trackedLinkElements.has(linkEl)) return;\n    this.trackedLinkElements.add(linkEl);\n    this.trackStylesheetInLinkElement(linkEl);\n  }\n  adoptStyleSheets(sheets, hostId) {\n    if (sheets.length === 0) return;\n    const adoptedStyleSheetData = {\n      id: hostId,\n      styleIds: []\n    };\n    const styles = [];\n    for (const sheet of sheets) {\n      let styleId;\n      if (!this.styleMirror.has(sheet)) {\n        styleId = this.styleMirror.add(sheet);\n        const rules = Array.from(sheet.rules || CSSRule);\n        styles.push({\n          styleId,\n          rules: rules.map((r, index) => {\n            return {\n              rule: getCssRuleString(r),\n              index\n            };\n          })\n        });\n      } else styleId = this.styleMirror.getId(sheet);\n      adoptedStyleSheetData.styleIds.push(styleId);\n    }\n    if (styles.length > 0) adoptedStyleSheetData.styles = styles;\n    this.adoptedStyleSheetCb(adoptedStyleSheetData);\n  }\n  reset() {\n    this.styleMirror.reset();\n    this.trackedLinkElements = new WeakSet();\n  }\n  trackStylesheetInLinkElement(linkEl) {}\n}\nexport { StylesheetManager };","map":{"version":3,"names":["getCssRuleString","StyleSheetMirror","StylesheetManager","constructor","options","trackedLinkElements","WeakSet","styleMirror","mutationCb","adoptedStyleSheetCb","attachLinkElement","linkEl","childSn","attributes","adds","removes","texts","id","trackLinkElement","has","add","trackStylesheetInLinkElement","adoptStyleSheets","sheets","hostId","length","adoptedStyleSheetData","styleIds","styles","sheet","styleId","rules","Array","from","CSSRule","push","map","r","index","rule","getId","reset"],"sources":["/Users/ogonen/rrweb/node_modules/rrweb/es/rrweb/packages/rrweb/src/record/stylesheet-manager.js"],"sourcesContent":["import { getCssRuleString } from '../../../rrweb-snapshot/es/rrweb-snapshot.js';\nimport { StyleSheetMirror } from '../utils.js';\n\nclass StylesheetManager {\r\n    constructor(options) {\r\n        this.trackedLinkElements = new WeakSet();\r\n        this.styleMirror = new StyleSheetMirror();\r\n        this.mutationCb = options.mutationCb;\r\n        this.adoptedStyleSheetCb = options.adoptedStyleSheetCb;\r\n    }\r\n    attachLinkElement(linkEl, childSn) {\r\n        if ('_cssText' in childSn.attributes)\r\n            this.mutationCb({\r\n                adds: [],\r\n                removes: [],\r\n                texts: [],\r\n                attributes: [\r\n                    {\r\n                        id: childSn.id,\r\n                        attributes: childSn\r\n                            .attributes,\r\n                    },\r\n                ],\r\n            });\r\n        this.trackLinkElement(linkEl);\r\n    }\r\n    trackLinkElement(linkEl) {\r\n        if (this.trackedLinkElements.has(linkEl))\r\n            return;\r\n        this.trackedLinkElements.add(linkEl);\r\n        this.trackStylesheetInLinkElement(linkEl);\r\n    }\r\n    adoptStyleSheets(sheets, hostId) {\r\n        if (sheets.length === 0)\r\n            return;\r\n        const adoptedStyleSheetData = {\r\n            id: hostId,\r\n            styleIds: [],\r\n        };\r\n        const styles = [];\r\n        for (const sheet of sheets) {\r\n            let styleId;\r\n            if (!this.styleMirror.has(sheet)) {\r\n                styleId = this.styleMirror.add(sheet);\r\n                const rules = Array.from(sheet.rules || CSSRule);\r\n                styles.push({\r\n                    styleId,\r\n                    rules: rules.map((r, index) => {\r\n                        return {\r\n                            rule: getCssRuleString(r),\r\n                            index,\r\n                        };\r\n                    }),\r\n                });\r\n            }\r\n            else\r\n                styleId = this.styleMirror.getId(sheet);\r\n            adoptedStyleSheetData.styleIds.push(styleId);\r\n        }\r\n        if (styles.length > 0)\r\n            adoptedStyleSheetData.styles = styles;\r\n        this.adoptedStyleSheetCb(adoptedStyleSheetData);\r\n    }\r\n    reset() {\r\n        this.styleMirror.reset();\r\n        this.trackedLinkElements = new WeakSet();\r\n    }\r\n    trackStylesheetInLinkElement(linkEl) {\r\n    }\r\n}\n\nexport { StylesheetManager };\n"],"mappings":"AAAA,SAASA,gBAAgB,QAAQ,8CAA8C;AAC/E,SAASC,gBAAgB,QAAQ,aAAa;AAE9C,MAAMC,iBAAiB,CAAC;EACpBC,WAAWA,CAACC,OAAO,EAAE;IACjB,IAAI,CAACC,mBAAmB,GAAG,IAAIC,OAAO,CAAC,CAAC;IACxC,IAAI,CAACC,WAAW,GAAG,IAAIN,gBAAgB,CAAC,CAAC;IACzC,IAAI,CAACO,UAAU,GAAGJ,OAAO,CAACI,UAAU;IACpC,IAAI,CAACC,mBAAmB,GAAGL,OAAO,CAACK,mBAAmB;EAC1D;EACAC,iBAAiBA,CAACC,MAAM,EAAEC,OAAO,EAAE;IAC/B,IAAI,UAAU,IAAIA,OAAO,CAACC,UAAU,EAChC,IAAI,CAACL,UAAU,CAAC;MACZM,IAAI,EAAE,EAAE;MACRC,OAAO,EAAE,EAAE;MACXC,KAAK,EAAE,EAAE;MACTH,UAAU,EAAE,CACR;QACII,EAAE,EAAEL,OAAO,CAACK,EAAE;QACdJ,UAAU,EAAED,OAAO,CACdC;MACT,CAAC;IAET,CAAC,CAAC;IACN,IAAI,CAACK,gBAAgB,CAACP,MAAM,CAAC;EACjC;EACAO,gBAAgBA,CAACP,MAAM,EAAE;IACrB,IAAI,IAAI,CAACN,mBAAmB,CAACc,GAAG,CAACR,MAAM,CAAC,EACpC;IACJ,IAAI,CAACN,mBAAmB,CAACe,GAAG,CAACT,MAAM,CAAC;IACpC,IAAI,CAACU,4BAA4B,CAACV,MAAM,CAAC;EAC7C;EACAW,gBAAgBA,CAACC,MAAM,EAAEC,MAAM,EAAE;IAC7B,IAAID,MAAM,CAACE,MAAM,KAAK,CAAC,EACnB;IACJ,MAAMC,qBAAqB,GAAG;MAC1BT,EAAE,EAAEO,MAAM;MACVG,QAAQ,EAAE;IACd,CAAC;IACD,MAAMC,MAAM,GAAG,EAAE;IACjB,KAAK,MAAMC,KAAK,IAAIN,MAAM,EAAE;MACxB,IAAIO,OAAO;MACX,IAAI,CAAC,IAAI,CAACvB,WAAW,CAACY,GAAG,CAACU,KAAK,CAAC,EAAE;QAC9BC,OAAO,GAAG,IAAI,CAACvB,WAAW,CAACa,GAAG,CAACS,KAAK,CAAC;QACrC,MAAME,KAAK,GAAGC,KAAK,CAACC,IAAI,CAACJ,KAAK,CAACE,KAAK,IAAIG,OAAO,CAAC;QAChDN,MAAM,CAACO,IAAI,CAAC;UACRL,OAAO;UACPC,KAAK,EAAEA,KAAK,CAACK,GAAG,CAAC,CAACC,CAAC,EAAEC,KAAK,KAAK;YAC3B,OAAO;cACHC,IAAI,EAAEvC,gBAAgB,CAACqC,CAAC,CAAC;cACzBC;YACJ,CAAC;UACL,CAAC;QACL,CAAC,CAAC;MACN,CAAC,MAEGR,OAAO,GAAG,IAAI,CAACvB,WAAW,CAACiC,KAAK,CAACX,KAAK,CAAC;MAC3CH,qBAAqB,CAACC,QAAQ,CAACQ,IAAI,CAACL,OAAO,CAAC;IAChD;IACA,IAAIF,MAAM,CAACH,MAAM,GAAG,CAAC,EACjBC,qBAAqB,CAACE,MAAM,GAAGA,MAAM;IACzC,IAAI,CAACnB,mBAAmB,CAACiB,qBAAqB,CAAC;EACnD;EACAe,KAAKA,CAAA,EAAG;IACJ,IAAI,CAAClC,WAAW,CAACkC,KAAK,CAAC,CAAC;IACxB,IAAI,CAACpC,mBAAmB,GAAG,IAAIC,OAAO,CAAC,CAAC;EAC5C;EACAe,4BAA4BA,CAACV,MAAM,EAAE,CACrC;AACJ;AAEA,SAAST,iBAAiB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}