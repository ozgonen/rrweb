{"ast":null,"code":"import { EventType, IncrementalSource } from '../../../types/dist/types.js';\nclass Timer {\n  constructor(actions = [], config) {\n    this.timeOffset = 0;\n    this.raf = null;\n    this.actions = actions;\n    this.speed = config.speed;\n    this.liveMode = config.liveMode;\n  }\n  addAction(action) {\n    if (!this.actions.length || this.actions[this.actions.length - 1].delay <= action.delay) {\n      this.actions.push(action);\n      return;\n    }\n    const index = this.findActionIndex(action);\n    this.actions.splice(index, 0, action);\n  }\n  start() {\n    this.timeOffset = 0;\n    let lastTimestamp = performance.now();\n    const check = () => {\n      const time = performance.now();\n      this.timeOffset += (time - lastTimestamp) * this.speed;\n      lastTimestamp = time;\n      while (this.actions.length) {\n        const action = this.actions[0];\n        if (this.timeOffset >= action.delay) {\n          this.actions.shift();\n          action.doAction();\n        } else {\n          break;\n        }\n      }\n      if (this.actions.length > 0 || this.liveMode) {\n        this.raf = requestAnimationFrame(check);\n      }\n    };\n    this.raf = requestAnimationFrame(check);\n  }\n  clear() {\n    if (this.raf) {\n      cancelAnimationFrame(this.raf);\n      this.raf = null;\n    }\n    this.actions.length = 0;\n  }\n  setSpeed(speed) {\n    this.speed = speed;\n  }\n  toggleLiveMode(mode) {\n    this.liveMode = mode;\n  }\n  isActive() {\n    return this.raf !== null;\n  }\n  findActionIndex(action) {\n    let start = 0;\n    let end = this.actions.length - 1;\n    while (start <= end) {\n      const mid = Math.floor((start + end) / 2);\n      if (this.actions[mid].delay < action.delay) {\n        start = mid + 1;\n      } else if (this.actions[mid].delay > action.delay) {\n        end = mid - 1;\n      } else {\n        return mid + 1;\n      }\n    }\n    return start;\n  }\n}\nfunction addDelay(event, baselineTime) {\n  if (event.type === EventType.IncrementalSnapshot && event.data.source === IncrementalSource.MouseMove && event.data.positions && event.data.positions.length) {\n    const firstOffset = event.data.positions[0].timeOffset;\n    const firstTimestamp = event.timestamp + firstOffset;\n    event.delay = firstTimestamp - baselineTime;\n    return firstTimestamp - baselineTime;\n  }\n  event.delay = event.timestamp - baselineTime;\n  return event.delay;\n}\nexport { Timer, addDelay };","map":{"version":3,"names":["EventType","IncrementalSource","Timer","constructor","actions","config","timeOffset","raf","speed","liveMode","addAction","action","length","delay","push","index","findActionIndex","splice","start","lastTimestamp","performance","now","check","time","shift","doAction","requestAnimationFrame","clear","cancelAnimationFrame","setSpeed","toggleLiveMode","mode","isActive","end","mid","Math","floor","addDelay","event","baselineTime","type","IncrementalSnapshot","data","source","MouseMove","positions","firstOffset","firstTimestamp","timestamp"],"sources":["/Users/ogonen/rrweb/node_modules/rrweb/es/rrweb/packages/rrweb/src/replay/timer.js"],"sourcesContent":["import { EventType, IncrementalSource } from '../../../types/dist/types.js';\n\nclass Timer {\r\n    constructor(actions = [], config) {\r\n        this.timeOffset = 0;\r\n        this.raf = null;\r\n        this.actions = actions;\r\n        this.speed = config.speed;\r\n        this.liveMode = config.liveMode;\r\n    }\r\n    addAction(action) {\r\n        if (!this.actions.length ||\r\n            this.actions[this.actions.length - 1].delay <= action.delay) {\r\n            this.actions.push(action);\r\n            return;\r\n        }\r\n        const index = this.findActionIndex(action);\r\n        this.actions.splice(index, 0, action);\r\n    }\r\n    start() {\r\n        this.timeOffset = 0;\r\n        let lastTimestamp = performance.now();\r\n        const check = () => {\r\n            const time = performance.now();\r\n            this.timeOffset += (time - lastTimestamp) * this.speed;\r\n            lastTimestamp = time;\r\n            while (this.actions.length) {\r\n                const action = this.actions[0];\r\n                if (this.timeOffset >= action.delay) {\r\n                    this.actions.shift();\r\n                    action.doAction();\r\n                }\r\n                else {\r\n                    break;\r\n                }\r\n            }\r\n            if (this.actions.length > 0 || this.liveMode) {\r\n                this.raf = requestAnimationFrame(check);\r\n            }\r\n        };\r\n        this.raf = requestAnimationFrame(check);\r\n    }\r\n    clear() {\r\n        if (this.raf) {\r\n            cancelAnimationFrame(this.raf);\r\n            this.raf = null;\r\n        }\r\n        this.actions.length = 0;\r\n    }\r\n    setSpeed(speed) {\r\n        this.speed = speed;\r\n    }\r\n    toggleLiveMode(mode) {\r\n        this.liveMode = mode;\r\n    }\r\n    isActive() {\r\n        return this.raf !== null;\r\n    }\r\n    findActionIndex(action) {\r\n        let start = 0;\r\n        let end = this.actions.length - 1;\r\n        while (start <= end) {\r\n            const mid = Math.floor((start + end) / 2);\r\n            if (this.actions[mid].delay < action.delay) {\r\n                start = mid + 1;\r\n            }\r\n            else if (this.actions[mid].delay > action.delay) {\r\n                end = mid - 1;\r\n            }\r\n            else {\r\n                return mid + 1;\r\n            }\r\n        }\r\n        return start;\r\n    }\r\n}\r\nfunction addDelay(event, baselineTime) {\r\n    if (event.type === EventType.IncrementalSnapshot &&\r\n        event.data.source === IncrementalSource.MouseMove &&\r\n        event.data.positions &&\r\n        event.data.positions.length) {\r\n        const firstOffset = event.data.positions[0].timeOffset;\r\n        const firstTimestamp = event.timestamp + firstOffset;\r\n        event.delay = firstTimestamp - baselineTime;\r\n        return firstTimestamp - baselineTime;\r\n    }\r\n    event.delay = event.timestamp - baselineTime;\r\n    return event.delay;\r\n}\n\nexport { Timer, addDelay };\n"],"mappings":"AAAA,SAASA,SAAS,EAAEC,iBAAiB,QAAQ,8BAA8B;AAE3E,MAAMC,KAAK,CAAC;EACRC,WAAWA,CAACC,OAAO,GAAG,EAAE,EAAEC,MAAM,EAAE;IAC9B,IAAI,CAACC,UAAU,GAAG,CAAC;IACnB,IAAI,CAACC,GAAG,GAAG,IAAI;IACf,IAAI,CAACH,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACI,KAAK,GAAGH,MAAM,CAACG,KAAK;IACzB,IAAI,CAACC,QAAQ,GAAGJ,MAAM,CAACI,QAAQ;EACnC;EACAC,SAASA,CAACC,MAAM,EAAE;IACd,IAAI,CAAC,IAAI,CAACP,OAAO,CAACQ,MAAM,IACpB,IAAI,CAACR,OAAO,CAAC,IAAI,CAACA,OAAO,CAACQ,MAAM,GAAG,CAAC,CAAC,CAACC,KAAK,IAAIF,MAAM,CAACE,KAAK,EAAE;MAC7D,IAAI,CAACT,OAAO,CAACU,IAAI,CAACH,MAAM,CAAC;MACzB;IACJ;IACA,MAAMI,KAAK,GAAG,IAAI,CAACC,eAAe,CAACL,MAAM,CAAC;IAC1C,IAAI,CAACP,OAAO,CAACa,MAAM,CAACF,KAAK,EAAE,CAAC,EAAEJ,MAAM,CAAC;EACzC;EACAO,KAAKA,CAAA,EAAG;IACJ,IAAI,CAACZ,UAAU,GAAG,CAAC;IACnB,IAAIa,aAAa,GAAGC,WAAW,CAACC,GAAG,CAAC,CAAC;IACrC,MAAMC,KAAK,GAAGA,CAAA,KAAM;MAChB,MAAMC,IAAI,GAAGH,WAAW,CAACC,GAAG,CAAC,CAAC;MAC9B,IAAI,CAACf,UAAU,IAAI,CAACiB,IAAI,GAAGJ,aAAa,IAAI,IAAI,CAACX,KAAK;MACtDW,aAAa,GAAGI,IAAI;MACpB,OAAO,IAAI,CAACnB,OAAO,CAACQ,MAAM,EAAE;QACxB,MAAMD,MAAM,GAAG,IAAI,CAACP,OAAO,CAAC,CAAC,CAAC;QAC9B,IAAI,IAAI,CAACE,UAAU,IAAIK,MAAM,CAACE,KAAK,EAAE;UACjC,IAAI,CAACT,OAAO,CAACoB,KAAK,CAAC,CAAC;UACpBb,MAAM,CAACc,QAAQ,CAAC,CAAC;QACrB,CAAC,MACI;UACD;QACJ;MACJ;MACA,IAAI,IAAI,CAACrB,OAAO,CAACQ,MAAM,GAAG,CAAC,IAAI,IAAI,CAACH,QAAQ,EAAE;QAC1C,IAAI,CAACF,GAAG,GAAGmB,qBAAqB,CAACJ,KAAK,CAAC;MAC3C;IACJ,CAAC;IACD,IAAI,CAACf,GAAG,GAAGmB,qBAAqB,CAACJ,KAAK,CAAC;EAC3C;EACAK,KAAKA,CAAA,EAAG;IACJ,IAAI,IAAI,CAACpB,GAAG,EAAE;MACVqB,oBAAoB,CAAC,IAAI,CAACrB,GAAG,CAAC;MAC9B,IAAI,CAACA,GAAG,GAAG,IAAI;IACnB;IACA,IAAI,CAACH,OAAO,CAACQ,MAAM,GAAG,CAAC;EAC3B;EACAiB,QAAQA,CAACrB,KAAK,EAAE;IACZ,IAAI,CAACA,KAAK,GAAGA,KAAK;EACtB;EACAsB,cAAcA,CAACC,IAAI,EAAE;IACjB,IAAI,CAACtB,QAAQ,GAAGsB,IAAI;EACxB;EACAC,QAAQA,CAAA,EAAG;IACP,OAAO,IAAI,CAACzB,GAAG,KAAK,IAAI;EAC5B;EACAS,eAAeA,CAACL,MAAM,EAAE;IACpB,IAAIO,KAAK,GAAG,CAAC;IACb,IAAIe,GAAG,GAAG,IAAI,CAAC7B,OAAO,CAACQ,MAAM,GAAG,CAAC;IACjC,OAAOM,KAAK,IAAIe,GAAG,EAAE;MACjB,MAAMC,GAAG,GAAGC,IAAI,CAACC,KAAK,CAAC,CAAClB,KAAK,GAAGe,GAAG,IAAI,CAAC,CAAC;MACzC,IAAI,IAAI,CAAC7B,OAAO,CAAC8B,GAAG,CAAC,CAACrB,KAAK,GAAGF,MAAM,CAACE,KAAK,EAAE;QACxCK,KAAK,GAAGgB,GAAG,GAAG,CAAC;MACnB,CAAC,MACI,IAAI,IAAI,CAAC9B,OAAO,CAAC8B,GAAG,CAAC,CAACrB,KAAK,GAAGF,MAAM,CAACE,KAAK,EAAE;QAC7CoB,GAAG,GAAGC,GAAG,GAAG,CAAC;MACjB,CAAC,MACI;QACD,OAAOA,GAAG,GAAG,CAAC;MAClB;IACJ;IACA,OAAOhB,KAAK;EAChB;AACJ;AACA,SAASmB,QAAQA,CAACC,KAAK,EAAEC,YAAY,EAAE;EACnC,IAAID,KAAK,CAACE,IAAI,KAAKxC,SAAS,CAACyC,mBAAmB,IAC5CH,KAAK,CAACI,IAAI,CAACC,MAAM,KAAK1C,iBAAiB,CAAC2C,SAAS,IACjDN,KAAK,CAACI,IAAI,CAACG,SAAS,IACpBP,KAAK,CAACI,IAAI,CAACG,SAAS,CAACjC,MAAM,EAAE;IAC7B,MAAMkC,WAAW,GAAGR,KAAK,CAACI,IAAI,CAACG,SAAS,CAAC,CAAC,CAAC,CAACvC,UAAU;IACtD,MAAMyC,cAAc,GAAGT,KAAK,CAACU,SAAS,GAAGF,WAAW;IACpDR,KAAK,CAACzB,KAAK,GAAGkC,cAAc,GAAGR,YAAY;IAC3C,OAAOQ,cAAc,GAAGR,YAAY;EACxC;EACAD,KAAK,CAACzB,KAAK,GAAGyB,KAAK,CAACU,SAAS,GAAGT,YAAY;EAC5C,OAAOD,KAAK,CAACzB,KAAK;AACtB;AAEA,SAASX,KAAK,EAAEmC,QAAQ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}